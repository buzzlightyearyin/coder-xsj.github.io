问题一：
SW2 的 G0/0/3 和 G0/0/4 接口都为指定端口 DP。
在 RSTP 中，选举根桥、根端口和指定端口主要使用配置 BPDU 中的消息优先级向量{根桥 ID, 根路径开销,发送设备网桥 ID, 发送端口 ID}，详细分析如下：
1、选举根桥
交换机初始情况下都认为自身为根桥，会发送根桥 ID 为自身网桥 ID 的配置 BPDU 消息，通过比较根桥 ID 选举当前网络中的根桥，比较过程如下：
（1）首先会比较网桥优先级，优先级最小的交换机会成为根桥。
（2）如果网桥优先级一致，然后比较网桥 MAC 地址，MAC 地址最小的交换机成为根桥。
因此在当前网络拓扑中，SW1 会成为根桥。

2、选举根端口 RP
每台非根网桥上都会选举唯一的根端口，根端口 RP 的选举会继续比较根路径开销 RPC，发送设备网桥 ID，发送端口 ID，比较过程如下：
（1）累加接收到配置 BPDU 中的根路径开销，选取根路径开销最小的接口。
（2）如果去往根桥的路径开销之和一致，则优选接收到配置 BPDU 发送设备网桥 ID 最小的接口。
（3）如果上述条件都一致，则优选接收到配置 BPDU 发送端口 ID 最小的接口。
（4）如果上述条件都一致，则优选自身接收到 BPDU 端口 ID 最小的接口。
因此再当前拓扑中，SW2 和 SW3 的 Eth-trunk 接口会成为根端口 RP。

3、选举指定端口 DP
指定端口 DP 作为向所在链路转发 BPDU 的最优接口，需要在每个链路上选举唯一的指定端口，其选举过程仍遵循上述 RP 比较原则
因此 SW2 和 SW3 之间链路上由于两者去往根桥的路径开销一致，所以继续比较 SW2 和 SW3 的发送设备网桥 ID，判断 SW2 为网桥 ID 最小的发送方设备。
因此 SW2 的 G0/0/3 和 G0/0/4 接口都为指定端口 DP，SW3 的 G0/0/3 和 G0/0/4 将会被堵塞，最终形成逻辑无环的拓扑。

问题二：
如果仅将 SW2 的 G0/0/1 接口退出 Eth-trunk 成为独立端口，SW1 的 G0/0/1 仍然为 Eth-trunk 成员端口，
由于采用手工负载分担模式不会通过 LACP 协议协商接口状态，所以所有接口仍然可以转发数据。
SW1 通过 Eth-trunk 转发 BPDU 采用逐流的负载分担方式，根据负载分担方式不同，则可能有两种情况：
情况一：如果 BPDU 报文是从 SW1 的 G0/0/1 接口发送，SW2 的端口角色和端口状态如下：
G0/0/1 为 RP 根端口，端口状态为 Forwarding
G0/0/2 为 Eth-trunk 成员端口为 DP 指定端口，端口状态为 Forwarding
G0/0/3 为 AP 替代端口，端口状态为 Discarding
G0/0/4 为 AP 替代端口，端口状态为 Discarding

情况二：如果 BPDU 报文是从 SW1 的 G0/0/2 接口发送，SW2 的端口角色和端口状态如下：
G0/0/1 为 DP 指定端口，端口状态为 Forwarding
G0/0/2 为 Eth-trunk 成员端口为 RP 根端口，端口状态为 Forwarding
G0/0/3 为 AP 替代端口，端口状态为 Discarding
G0/0/4 为 AP 替代端口，端口状态为 Discarding

在 RSTP 计算过程中会比较配置 BPDU 中的消息优先级向量{根桥 ID, 根路径开销,发送设备网桥 ID, 发送端口 ID}，完成端口角色的选举。
上述端口角色及状态选举过程分析如下：
1、选举根桥
在当前网络拓扑中，SW1 的网桥 ID 最小，所以 SW1 仍为根桥。

2、选举根端口 RP
SW2 的 G0/0/1 退出 Eth-trunk 之后，SW2 需要选举唯一的根端口。
（1）对于情况一
SW1 采用逐流负载分担后，BPDU 报文通过 G0/0/1 接口发送。
SW2 的 G0/0/1 接口可以正常接收到 SW1 周期发送的最优 BPDU 报文，该接口去往根桥路径开销最小，成为根端口 DP。
在 RSTP 情况下，直接进入 Forwarding 状态，无需等待两倍转发延时。

（2）对于情况二
SW1 采用逐流负载分担后，BPDU 报文通过 G0/0/2 接口发送。
SW2 的 G0/0/2 接口可以正常接收到 SW1 周期发送的最优 BPDU 报文，该接口去往根桥路径开销最小，成为根端口 DP。
在 RSTP 情况下，直接进入 Forwarding 状态，无需等待两倍转发延时。

3、选举指定端口 DP
（1）SW2 和 SW1 之间的链路
对于情况一：
SW1 采用逐流负载分担后，BPDU 报文通过 G0/0/1 接口发送。
导致 SW2 的 G0/0/2 接口无法接收到 SW1 发送的最优 BPDU 报文，超时计时器到期后，G0/0/2 会成为指定端口 DP。
首先会进入 Discarding 状态，等待两倍转发延时也就是 30s 之后，进入 Forwarding 状态。

对于情况二：
SW1 采用逐流负载分担后，BPDU 报文通过 G0/0/2 接口发送。
导致 SW2 的 G0/0/1 接口无法接收到 SW1 发送的最优 BPDU 报文，超时计时器到期后，G0/0/1 会成为指定端口 DP。
首先会进入 Discarding 状态，等待两倍转发延时也就是 30s 之后，进入 Forwarding 状态。

（2）SW2 和 SW3 之间的链路
SW2 的 G0/0/1 退出 Eth-trunk 之后，SW3 去往根桥 SW1 的链路仍为聚合链路，链路带宽较高，因此 SW2 去往 SW1 的跟路径开销要大于 SW3 去往 SW1 的跟路径开销，因此 SW3 作为指定交换机，SW3 的 G0/0/3 和 G0/0/4 接口都为指定端口 DP。
SW2 的 G0/0/3 和 G0/0/4 接口成为 AP 替换端口，端口状态为 Discarding。


LACP 方式
如果仅将 SW2 的 G0/0/1 接口退出 Eth-Trunk 成为独立端口，SW1 的 G0/0/1 仍为 Eth-trunk 成员端口。
LACP 协议会协商当前成员接口状态，协商失败后 SW1 会将 G0/0/1 接口置为 Unselect 状态，SW1 和 SW2 之间通过 G0/0/1 接口连接的链路无法正常转发数据，
此时 SW2 的端口角色和端口状态如下：
G0/0/1 为 DP 指定端口，端口状态为 Forwarding
G0/0/2 为 Eth-trunk 成员端口为 RP 根端口，端口状态为 Forwarding
G0/0/3 为 AP 替代端口，端口状态为 Discarding
G0/0/4 为 AP 替代端口，端口状态为 Discarding

在 RSTP 计算过程中会比较配置 BPDU 中的消息优先级向量{根桥 ID, 根路径开销,发送设备网桥 ID, 发送端口 ID}，完成端口角色的选举。
上述端口角色及状态选举过程分析如下：
1、选举根桥
在当前网络拓扑中，SW1 的网桥 ID 最小，所以 SW1 仍为根桥。

2、选举指定端口 DP
对于 SW2 而言，G0/0/1 接口退出 Eth-trunk 之后。
SW2 的 G0/0/2 仍属于 Eth-trunk，仍可以接收到 SW1 周期发送的最优 BPDU 报文，成为根端口 RP。
RSTP情况下，端口状态直接进入 Forwarding 状态，无需等待转发延时。

3、选举指定端口 DP
（1）SW2 和 SW1 之间链路
SW2 的 G0/0/1 接口退出 Eth-trunk 之后。
LACP 协议协商接口状态，协商失败后 SW1 会将 G0/0/1 接口置为 Unselected 状态，该接口不会在发送 BPDU 等报文。
导致 SW2 的 G0/0/1 无法接收到 SW1 周期发送的最优 BPDU 报文，超时计时器到期后该接口会成为指定端口 DP，
首先会进入 Discarding 状态，等待两倍转发延时也就是 30s 之后，进入 Forwarding 状态。

（2）SW2 和 SW3 之间链路
SW2 的 G0/0/1 接口退出 Eth-trunk 之后。
SW3 去往根桥 SW1 的链路仍为聚合链路，链路带宽较高，SW2 去往根桥路径开销要大于 SW3 区域根桥路径开销，
所以 SW3 成为指定交换机，SW3 的 G0/0/3 和 G0/0/4 接口成为指定端口 DP，
SW2 的 G0/0/3 和 G0/0/4 接口成为 AP 替代端口，端口状态为 Discarding。
