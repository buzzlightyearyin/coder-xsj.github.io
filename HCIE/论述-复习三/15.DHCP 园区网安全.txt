问题一：
针对部分终端设备无法访问网关，且存在大量 ARP 表项翻动，同时部分终端设备无法通过 DHCP 服务器正常获取 IP 地址，结合当前拓扑，分析可能原因，排障思路如下：
一、物理层链路翻动导致故障
如果交换机之间互联链路频繁 up/down 导致震荡的情况，可能会导致上述现象，可以通过查看设备日志信息快速判断是否存在链路翻动情况。
上述故障可以通过更换线缆或者端口模块进行故障排除。

二、欺骗攻击导致上述故障
1、arp 中间人攻击
在网关设备上通过 display arp all 观察 arp 表项，存在 arp 表现翻动，初步判断存在 arp 欺骗攻击，攻击者会伪造 arp 应答消息，导致网关设备或部分终端设备频繁更新表项，数据流量错误发送至攻击者。
上述攻击可以通过 arp 表项固化、arp 严格学习，DAI 动态 arp 检测等技术解决。

2、网关欺骗攻击
在终端设备上通过 arp -a 观察网关设备对应的 arp 表项，如果终端设备的 arp 表项翻动，则说明存在针对网关的欺骗攻击。
上述攻击可以通过配置 arp 防网关冲突，网关发送免费 arp 等技术解决。

3、DHCP 服务器欺骗攻击
如果存在攻击者仿冒 DHCP 服务器，导致客户端无法通过合法服务器正确获取 IP 地址。
上述攻击可以通过 DHCP Snooping 的信任功能，配置连接合法 DHCP Server 的接口为信任接口即可。

三、泛洪攻击导致上述故障
1、arp 报文泛洪攻击
在网关设备上通过 display cpu-defend statistics packet-type arp-request / arp-reply all 命令观察是否存在大量 arp 报文被丢弃，若存在大量 arp 报文被丢弃，则说明存在 arp 泛洪攻击导致无法通信。
上述攻击可以通过配置 arp 报文限速功能解决，如果针对 arp 表项空间的攻击可以通过 arp 表项限制功能解决。

2、DHCP 报文泛洪攻击
如果攻击者伪造大量 DHCP 发现报文，DHCP 请求报文也会导致交换机无法处理合法报文导致上述故障，我们可以通过 display cpu-defend statistics packet-type dhcp-client 观察是否存在大量 DHCP 请求报文被丢弃。
上述攻击可以通过 DHCP Snooping 功能的报文限速功能来进行防范。

3、DHCP 拒绝服务攻击
存在 DHCP 饿死攻击，攻击者会伪造 DHCP 请求报文中的 CHADDR 字段不断向 DHCP 服务器申请 IP 地址，导致服务器地址池被耗空，无法为合法用户分配地址。
上述攻击可以通过开启 DHCP Snooping 功能，限制端口允许接入的最大用户数量，同时开启 DHCP Snooping 的检查 CHADDR 字段功能，防止非法接入。

4、TC 泛洪攻击
上述网络拓扑中交换机接收到 TC 报文之后，会执行 MAC 地址表项和 arp 表项的删除操作，如果攻击者伪造 TC 报文并频繁发送，也会导致交换机表项翻动造成上述故障。
上述攻击可以通过配置 STP TC 保护功能来进行防范。

四、设备性能规格及配置问题
如果当前网络规模超出当前设备的性能和空间表项规格，也可能会导致上述故障，建议升级设备配置。
如果存在人为配置错误的可能，可以通过 display history-command 命令观察设备近期配置，如果存在，则建议对设备管理层面加固。

问题二：
考虑到该园区网络的拓扑设计和业务类型，针对该园区网的非法接入，可以通过如下几个角度来进行防范：
一、MAC 地址安全及端口安全
接入交换机从 MAC 地址表层面，针对部分固定 MAC 地址的攻击可以通过配置 MAC 黑洞地址条目来实现安全防护，配置端口安全可以通过 sticky 方式形成 MAC 地址表项，限制接口学习到的 MAC 地址条目数及保护行为，可以一定程度上防止非法接入问题。

二、DAI 动态 arp 检测
针对非法客户端接入之后可能存在的 ARP 欺骗攻击，在开启了 DHCP Snooping 功能之后形成（IP、MAC、接口、VLAN）的用户绑定表项，开启 DAI 动态 arp 检测功能之后，利用形成的 DHCP Snooping 绑定表项完成对 arp 报文的合法性检测，防止 arp 中间人等欺骗攻击。

三、IPSG IP 源防护
针对非法客户端接入之后可能存在的 IP 地址欺骗攻击，在开启了 DHCP Snooping 功能之后利用形成的 DHCP Snooping 绑定表项完成对 IP 报文的合法性检测，防止非法客户端静态修改 IP 地址，进行 IP 地址欺骗攻击等行为。

四、边缘端口配置保护机制
非法客户端如果伪造 STP 报文如 TC BPDU 也会导致整个交换网络因拓扑发生变更产生震荡的问题，可以通过边缘端口的配置解决上述问题，边缘端口可以加速接口的收敛，且不会因为端口状态迁移触发拓扑更新，配置 BPDU 保护等技术可以防范针对 STP 的恶意攻击。

五、NAC 网络接入控制
上述攻击防范一定程度上可以避免非法接入者带来的攻击，但是无法彻底阻断非法接入问题，可以通过部署华为园区安全解决方案，利用 imaster NCE Campus 产品结合接入交换机上 NAC 网络接入控制等技术，拒绝非法接入实现企业网络安全。
该园区网络场景我们主要通过 802.1X 认证进行终端接入控制，终端设备安装 802.1X 客户端软件之后，用户接入网络后接入交换机发起认证申请，接入交换机和用户终端进行信息交互后，将用户信息提交到认证服务器（如 Radius 服务器）进行认证，认证成功后，接入交换机就会将相应接口作为授权接口。
针对打印机等无法安装 802.1X 客户端的设备，采用 MAC 地址认证，接入交换机将打印机 MAC 地址作为用户名和密码上送至认证服务器进行认证，认证成功后打印机设备可以访问网络。 









