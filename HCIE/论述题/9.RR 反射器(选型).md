# RR 反射器(选型)

## 1. 题目1

​	公司采购两台路由器作为RR，路由器有很多指标：NAT、QoS能力等，该路由器不兼任ASBR、P角色，请你写出觉得最重要的两个指标，为什么？

​	RR 会与骨干网络中的所有路由器建立 `IBGP` 对等体，考虑到 RR 设备不担任 `ASBR` 或者 `P` 角色，主要负责路由计算、路由传递等工作。

​	购买两台路由器作为 RR 可以考虑部署主备 RR，配置相同的 `Cluster-id` 避免路由重复、环路风险。

​	而针对 RR 采购主要考虑如下两个关键指标：

### 一、最大承载路由表条目数量

​	路由表规格指的是设备可以承载的最大路由条目数，RR 路由反射器需要较高的路由表规格，承载大规模路由。

​	结合骨干网组网特点和业务类型，主要原因如下：

​	（1）骨干网组网特点

​				RR 路由反射器作为骨干网控制层面的核心设备，为了正确的完成路由反射工作，需要承载整个骨干网的所有 `BGP` 路由。

​	（2）骨干网业务类型

​				骨干网业务类型可能需要传递 `IPv4、IPv6、VPNv4、EVPN` 等路由信息，不同地址族的 `BGP` 路由也会直接导致路由条目数增加。

因此 RR 需要保证可承载路由条目数较大。

### 二、最大支持对等体关系数量

​			在骨干网络中，RR 虽然不担任 ASBR 或 P 设备角色，但 RR 需要与所有 `BGP` 路由器建立 `IBGP` 对等体关系，以保证路由正常传递，而BGP 对等体关系是基于 `TCP` 建立的，而维系大量的 `TCP` 会话需要消耗较高的 `CPU` 和内存资源。

因此 RR 需要支持更多的 BGP 对等体关系数量。

## 题目2

​	RR上存在接口板卡，对于接口板规格需求是否有要求，跟ASBR、P设备相比，你认为RR的接口板卡性能较高还是较低，为什么？

​	在 AS 内，RR 可能需要承担路由传递和流量转发两个作用，我们可以根据 RR 是否承担流量转发的角色来决定接口板卡规格。

### 一、RR 设备不承担流量转发

​	如果通过旁挂的方式将 RR 部署到现网当中，仅参与控制层面接收、反射 `BGP` 路由。

`BGP` 层面我们可以配置 `bgp-rib-only` 实现路由器仅处理 `BGP` 路由，而不会将路由下发到 `IP` 路由表，一定程度提升路由传递效率，降低路由器资源消耗；

​	同时为了避免数据转发的路由黑洞问题，我们需要保证 `BGP` 路由下一跳迭代时，底层 `IGP` 流量不会流经 RR 设备，需要将 RR 直连链路的 `IGP` 开销值修改为较大的值。

我们可以利用 `IGP` 特殊命令实现流量不经过 RR 转发，命令如下：

如果 `IGP` 采用 `OSPF` 协议，可以通过配置 `stub-router` 实现，配置命令如下：

```sql
ospf x				// 进入 OSPF 视图
    stub-router [on-startup [interval]]	// 设置 LSA 中的链路的度量值为（65535）
```

如果 `IGP` 采用 `ISIS` 协议，可以通过配置 `set-overload` 实现，配置命令如下：

```sql
isis x			// 进入 isis 视图
    set-overload	// 设置 LSP 的过载标志位，不适用该 LSP 进行 SPF 计算
```

在上述使用 RR 旁挂的场景中， RR 仅参与路由计算不参与流量转发，相较于 `ASBR` 和 `P` 设备，对接口板规格及转发性能要求相对较低。

### 二、RR 设备同时承担流量转发

​	RR 参与控制层面路由计算、路由传递，同时也可能参与到数据层面的流量转发，该场景网络可以提供更高的冗余性，但是由于 RR 参与到数据转发，相较于 `ASBR` 和 `P` 设备，对接口板规格和转发性能要求较高。

